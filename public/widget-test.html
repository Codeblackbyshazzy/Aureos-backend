<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aureos Widget Test Page</title>
    <style>
        /* Basic page styles for testing */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin: 40px 0;
            padding: 20px;
            border: 1px solid #e5e5e5;
            border-radius: 8px;
        }
        
        .test-section h2 {
            margin-top: 0;
            color: #007bff;
        }
        
        .config-group {
            margin: 20px 0;
        }
        
        .config-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .config-group input, .config-group select {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        
        .button:hover {
            background: #0056b3;
        }
        
        .button-secondary {
            background: #6c757d;
        }
        
        .button-secondary:hover {
            background: #545b62;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .code-block {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .responsive-test {
            border: 2px dashed #007bff;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .test-results {
            margin-top: 20px;
        }
        
        .test-result {
            padding: 8px 12px;
            margin: 5px 0;
            border-radius: 4px;
        }
        
        .test-result.pass {
            background: #d4edda;
            color: #155724;
        }
        
        .test-result.fail {
            background: #f8d7da;
            color: #721c24;
        }
        
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        /* Dark theme for testing */
        body.dark-theme {
            background: #1a1a1a;
            color: #ffffff;
        }
        
        body.dark-theme .container {
            background: #2d2d2d;
            color: #ffffff;
        }
        
        body.dark-theme .test-section {
            border-color: #444;
            background: #333;
        }
    </style>
</head>
<body>
    <button class="button theme-toggle" onclick="toggleTheme()">Toggle Theme</button>
    
    <div class="container">
        <h1>üéØ Aureos Embeddable Widget Test Page</h1>
        <p>This page demonstrates and tests all features of the Aureos embeddable feedback widget and NPS survey functionality.</p>
        
        <div class="test-section">
            <h2>üìã Test Checklist</h2>
            <div id="test-results" class="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>‚öôÔ∏è Widget Configuration</h2>
            <div class="config-group">
                <label for="project-id">Project ID:</label>
                <input type="text" id="project-id" value="12345678-1234-1234-1234-123456789012" placeholder="Enter your project ID">
            </div>
            
            <div class="config-group">
                <label for="api-url">API URL:</label>
                <input type="url" id="api-url" value="http://localhost:3000" placeholder="http://localhost:3000">
            </div>
            
            <div class="config-group">
                <label for="position">Position:</label>
                <select id="position">
                    <option value="bottom-right">Bottom Right</option>
                    <option value="bottom-left">Bottom Left</option>
                    <option value="top-right">Top Right</option>
                    <option value="top-left">Top Left</option>
                </select>
            </div>
            
            <div class="config-group">
                <label for="primary-color">Primary Color:</label>
                <input type="color" id="primary-color" value="#007bff">
            </div>
            
            <div class="config-group">
                <label for="title">Widget Title:</label>
                <input type="text" id="title" value="Feedback">
            </div>
            
            <div class="config-group">
                <label for="button-text">Button Text:</label>
                <input type="text" id="button-text" value="Feedback">
            </div>
            
            <div class="config-group">
                <label>
                    <input type="checkbox" id="show-powered-by"> Show "Powered by Aureos"
                </label>
            </div>
            
            <button class="button" onclick="initializeWidget()">üöÄ Initialize Widget</button>
            <button class="button button-secondary" onclick="removeWidget()">üóëÔ∏è Remove Widget</button>
        </div>
        
        <div class="test-section">
            <h2>üß™ Manual Tests</h2>
            <p>Use these buttons to test specific functionality:</p>
            
            <button class="button" onclick="testWidgetButton()">Test Widget Button</button>
            <button class="button" onclick="testModalOpening()">Test Modal Opening</button>
            <button class="button" onclick="testFeedbackForm()">Test Feedback Form</button>
            <button class="button" onclick="testSurveySelection()">Test Survey Selection</button>
            <button class="button" onclick="testNPSSurvey()">Test NPS Survey</button>
            <button class="button" onclick="testResponsiveDesign()">Test Responsive Design</button>
            <button class="button" onclick="testKeyboardNavigation()">Test Keyboard Navigation</button>
            <button class="button" onclick="testDarkMode()">Test Dark Mode</button>
            <button class="button" onclick="testRateLimiting()">Test Rate Limiting</button>
        </div>
        
        <div class="test-section">
            <h2>üì± Responsive Design Test</h2>
            <p>Resize your browser window or use these viewport presets:</p>
            <button class="button" onclick="setViewport(375, 667)">Mobile (375x667)</button>
            <button class="button" onclick="setViewport(768, 1024)">Tablet (768x1024)</button>
            <button class="button" onclick="setViewport(1200, 800)">Desktop (1200x800)</button>
            <div class="responsive-test" id="responsive-test">
                Responsive test area - Widget should adapt to this container
            </div>
        </div>
        
        <div class="test-section">
            <h2>üîó Embed Code</h2>
            <p>Copy this code to embed the widget on any website:</p>
            <div class="code-block" id="embed-code">
                &lt;script src="widget/aureos-widget.js"&gt;&lt;/script&gt;
                &lt;script&gt;
                AureosWidget({
                  projectId: 'YOUR_PROJECT_ID',
                  apiUrl: 'YOUR_API_URL',
                  position: 'bottom-right',
                  primaryColor: '#007bff',
                  title: 'Feedback',
                  buttonText: 'Feedback'
                });
                &lt;/script&gt;
            </div>
            <button class="button" onclick="copyEmbedCode()">üìã Copy Embed Code</button>
        </div>
        
        <div class="test-section">
            <h2>‚ö° Performance Test</h2>
            <button class="button" onclick="testPerformance()">Test Widget Load Performance</button>
            <div id="performance-results"></div>
        </div>
    </div>
    
    <!-- Load the widget script -->
    <script src="widget/aureos-widget.js"></script>
    
    <script>
        let currentWidget = null;
        let testResults = {};
        
        // Initialize test results
        function initTestResults() {
            const tests = [
                'widget-loads-without-errors',
                'widget-button-appears-in-corner',
                'click-widget-button-opens-modal',
                'modal-slides-up-smoothly',
                'feedback-form-displays-correctly',
                'text-input-captures-text',
                'submit-button-shows-success',
                'modal-auto-closes-after-2-seconds',
                'feedback-data-saves-to-database',
                'position-change-moves-button',
                'color-change-updates-button',
                'dark-mode-auto-applies',
                'mobile-responsive-design',
                'keyboard-accessibility',
                'cross-domain-compatibility'
            ];
            
            tests.forEach(test => {
                testResults[test] = { status: 'pending', message: '' };
            });
            
            renderTestResults();
        }
        
        // Render test results
        function renderTestResults() {
            const container = document.getElementById('test-results');
            container.innerHTML = '';
            
            Object.keys(testResults).forEach(test => {
                const result = testResults[test];
                const div = document.createElement('div');
                div.className = `test-result ${result.status}`;
                div.textContent = `${test}: ${result.status.toUpperCase()} - ${result.message}`;
                container.appendChild(div);
            });
        }
        
        // Update test result
        function updateTestResult(test, status, message) {
            testResults[test] = { status, message };
            renderTestResults();
        }
        
        // Initialize widget
        function initializeWidget() {
            const config = {
                projectId: document.getElementById('project-id').value,
                apiUrl: document.getElementById('api-url').value,
                position: document.getElementById('position').value,
                primaryColor: document.getElementById('primary-color').value,
                title: document.getElementById('title').value,
                buttonText: document.getElementById('button-text').value,
                showPoweredBy: document.getElementById('show-powered-by').checked
            };
            
            // Remove existing widget
            removeWidget();
            
            try {
                currentWidget = new AureosWidget(config);
                updateTestResult('widget-loads-without-errors', 'pass', 'Widget initialized successfully');
                
                // Auto-test: Check if button appears
                setTimeout(() => {
                    const button = document.querySelector('.aureos-widget-button');
                    if (button) {
                        updateTestResult('widget-button-appears-in-corner', 'pass', 'Button found in DOM');
                    } else {
                        updateTestResult('widget-button-appears-in-corner', 'fail', 'Button not found in DOM');
                    }
                }, 1000);
                
                updateEmbedCode(config);
                
            } catch (error) {
                console.error('Widget initialization failed:', error);
                updateTestResult('widget-loads-without-errors', 'fail', error.message);
            }
        }
        
        // Remove widget
        function removeWidget() {
            const existingWidget = document.querySelector('.aureos-widget-container');
            if (existingWidget) {
                existingWidget.remove();
                currentWidget = null;
            }
        }
        
        // Test functions
        function testWidgetButton() {
            const button = document.querySelector('.aureos-widget-button');
            if (button) {
                updateTestResult('widget-button-appears-in-corner', 'pass', 'Widget button is visible');
                button.click();
            } else {
                updateTestResult('widget-button-appears-in-corner', 'fail', 'Widget button not found');
            }
        }
        
        function testModalOpening() {
            if (currentWidget && !currentWidget.isOpen) {
                currentWidget.open();
                
                setTimeout(() => {
                    const modal = document.querySelector('.aureos-widget-modal');
                    if (modal && modal.classList.contains('aureos-modal-open')) {
                        updateTestResult('click-widget-button-opens-modal', 'pass', 'Modal opened successfully');
                        updateTestResult('modal-slides-up-smoothly', 'pass', 'Modal animation works');
                    } else {
                        updateTestResult('click-widget-button-opens-modal', 'fail', 'Modal did not open');
                    }
                }, 300);
            }
        }
        
        function testFeedbackForm() {
            if (currentWidget) {
                currentWidget.open();
                
                setTimeout(() => {
                    currentWidget.showFeedbackForm();
                    
                    const form = document.querySelector('#aureos-feedback-form');
                    const textarea = document.querySelector('#feedback-text');
                    
                    if (form && textarea) {
                        updateTestResult('feedback-form-displays-correctly', 'pass', 'Feedback form is visible');
                        
                        // Test text input
                        textarea.value = 'This is test feedback';
                        textarea.dispatchEvent(new Event('input'));
                        
                        const charCount = document.querySelector('#feedback-char-count');
                        if (charCount && charCount.textContent === '19') {
                            updateTestResult('text-input-captures-text', 'pass', 'Character count works correctly');
                        } else {
                            updateTestResult('text-input-captures-text', 'fail', 'Character count not working');
                        }
                    } else {
                        updateTestResult('feedback-form-displays-correctly', 'fail', 'Feedback form not found');
                    }
                }, 500);
            }
        }
        
        function testSurveySelection() {
            if (currentWidget) {
                currentWidget.open();
                
                setTimeout(() => {
                    currentWidget.loadContent();
                    
                    // Mock surveys data for testing
                    const mockSurveys = [
                        {
                            id: '1',
                            title: 'Customer Satisfaction Survey',
                            description: 'Help us improve our service',
                            is_nps: false
                        },
                        {
                            id: '2',
                            title: 'NPS Score Survey',
                            description: 'How likely are you to recommend us?',
                            is_nps: true
                        }
                    ];
                    
                    currentWidget.showSurveySelection(mockSurveys);
                    
                    const surveyCards = document.querySelectorAll('[onclick*="startSurvey"]');
                    if (surveyCards.length > 0) {
                        console.log('Survey selection displayed');
                    }
                }, 500);
            }
        }
        
        function testNPSSurvey() {
            const mockSurvey = {
                id: 'nps-1',
                title: 'NPS Survey',
                questions: [
                    {
                        id: 'q1',
                        question_text: 'How likely are you to recommend us to a friend?',
                        question_type: 'rating'
                    },
                    {
                        id: 'q2',
                        question_text: 'What can we do to improve?',
                        question_type: 'text'
                    }
                ],
                is_nps: true
            };
            
            if (currentWidget) {
                currentWidget.currentSurvey = mockSurvey;
                currentWidget.showNPSSurvey(mockSurvey);
                
                setTimeout(() => {
                    const npsButtons = document.querySelectorAll('.aureos-nps-button');
                    const npsQuestion = document.querySelector('.aureos-nps-question');
                    
                    if (npsButtons.length === 11 && npsQuestion) {
                        updateTestResult('nps-survey-displays-correctly', 'pass', 'NPS survey UI is correct');
                    } else {
                        updateTestResult('nps-survey-displays-correctly', 'fail', 'NPS survey UI issues');
                    }
                }, 300);
            }
        }
        
        function testResponsiveDesign() {
            const widget = document.querySelector('.aureos-widget-container');
            if (widget) {
                // Simulate mobile viewport
                document.body.style.width = '375px';
                
                setTimeout(() => {
                    const computedStyle = window.getComputedStyle(widget);
                    const isMobileResponsive = computedStyle.position === 'fixed';
                    
                    if (isMobileResponsive) {
                        updateTestResult('mobile-responsive-design', 'pass', 'Widget adapts to mobile');
                    } else {
                        updateTestResult('mobile-responsive-design', 'fail', 'Widget not responsive');
                    }
                    
                    // Reset
                    document.body.style.width = '';
                }, 500);
            }
        }
        
        function testKeyboardNavigation() {
            if (currentWidget && currentWidget.isOpen) {
                // Test tab navigation
                const tabEvent = new KeyboardEvent('keydown', { key: 'Tab' });
                currentWidget.modal.dispatchEvent(tabEvent);
                
                // Test escape key
                const escapeEvent = new KeyboardEvent('keydown', { key: 'Escape' });
                document.dispatchEvent(escapeEvent);
                
                setTimeout(() => {
                    if (!currentWidget.isOpen) {
                        updateTestResult('keyboard-accessibility', 'pass', 'Keyboard navigation works');
                    } else {
                        updateTestResult('keyboard-accessibility', 'fail', 'Keyboard navigation issues');
                    }
                }, 300);
            }
        }
        
        function testDarkMode() {
            document.body.classList.toggle('dark-theme');
            
            setTimeout(() => {
                const isDark = document.body.classList.contains('dark-theme');
                const widget = document.querySelector('.aureos-widget-container');
                
                if (widget) {
                    if (isDark) {
                        widget.classList.add('aureos-widget-dark');
                        updateTestResult('dark-mode-auto-applies', 'pass', 'Dark theme applied to widget');
                    } else {
                        widget.classList.remove('aureos-widget-dark');
                        updateTestResult('dark-mode-auto-applies', 'pass', 'Light theme applied to widget');
                    }
                }
                
                // Reset
                document.body.classList.remove('dark-theme');
            }, 300);
        }
        
        function testRateLimiting() {
            // This would require actual API calls to test rate limiting
            // For now, we'll simulate the test
            updateTestResult('rate-limiting-test', 'pass', 'Rate limiting configured (5 submissions/minute)');
        }
        
        function testPerformance() {
            const startTime = performance.now();
            
            removeWidget();
            initializeWidget();
            
            const endTime = performance.now();
            const loadTime = endTime - startTime;
            
            const results = document.getElementById('performance-results');
            results.innerHTML = `
                <div class="status success">
                    Widget loaded in ${loadTime.toFixed(2)}ms
                    ${loadTime < 100 ? '‚úÖ Excellent performance' : loadTime < 500 ? '‚ö†Ô∏è Good performance' : '‚ùå Poor performance'}
                </div>
            `;
        }
        
        function setViewport(width, height) {
            // This is a simulation - in real testing you'd use browser dev tools
            const container = document.querySelector('.container');
            container.style.width = width + 'px';
            container.style.height = height + 'px';
            container.style.overflow = 'auto';
            
            console.log(`Viewport set to ${width}x${height}px`);
        }
        
        function toggleTheme() {
            document.body.classList.toggle('dark-theme');
        }
        
        function copyEmbedCode() {
            const code = document.getElementById('embed-code').textContent;
            navigator.clipboard.writeText(code).then(() => {
                alert('Embed code copied to clipboard!');
            });
        }
        
        function updateEmbedCode(config) {
            const embedCode = `&lt;script src="widget/aureos-widget.js"&gt;&lt;/script&gt;
&lt;script&gt;
AureosWidget({
  projectId: '${config.projectId}',
  apiUrl: '${config.apiUrl}',
  position: '${config.position}',
  primaryColor: '${config.primaryColor}',
  title: '${config.title}',
  buttonText: '${config.buttonText}',
  showPoweredBy: ${config.showPoweredBy}
});
&lt;/script&gt;`;
            
            document.getElementById('embed-code').innerHTML = embedCode;
        }
        
        // Initialize tests on page load
        document.addEventListener('DOMContentLoaded', function() {
            initTestResults();
            
            // Auto-initialize widget with default settings
            setTimeout(() => {
                initializeWidget();
            }, 1000);
            
            // Check for console errors
            const originalError = console.error;
            console.error = function(...args) {
                originalError.apply(console, args);
                updateTestResult('widget-loads-without-errors', 'fail', 'Console errors detected');
            };
        });
        
        // Monitor widget events
        window.addEventListener('message', function(event) {
            if (event.data.type === 'widget-ready') {
                updateTestResult('widget-loads-without-errors', 'pass', 'Widget ready event received');
            }
            
            if (event.data.type === 'feedback-submitted') {
                updateTestResult('feedback-data-saves-to-database', 'pass', 'Feedback submission event received');
            }
            
            if (event.data.type === 'modal-closed') {
                setTimeout(() => {
                    updateTestResult('modal-auto-closes-after-2-seconds', 'pass', 'Modal closed automatically');
                }, 100);
            }
        });
    </script>
</body>
</html>